@{ ViewBag.Title = "Home"; }

<textarea id="editor"></textarea>

<p id="result"></p>

@section PageScripts {
    <script>
        (function(Compilify) {
            var root = this,
                $ = root.jQuery,
                _ = root._,
                CodeMirror = root.CodeMirror;
            
            var compile = _.debounce(function( text ) {
                $.ajax({
                    url: '/compile',
                    type: 'POST',
                    cache: false,
                    contentType: 'application/json; charset=utf-8',
                    data: root.JSON.stringify({ code: text }),
                    dataType: 'json',

                    success: function( resp ) {
                        $('#result').html(resp.data);
                    }
                });
            }, 500);

            $(function() {
                var textarea = document.getElementById('editor');

                Compilify.Editor = CodeMirror.fromTextArea(textarea, {
                    indentUnit: 4,
                    lineNumbers: true,
                    onChange: function() { },
                    onKeyEvent: function(editor, key) {
                        
                        compile(editor.getValue());
                        
                    }
                });

            });
    
        }).call(window, window.Compilify || {});
    </script>
}
